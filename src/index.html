<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="../node_modules/web3/dist/web3.min.js"></script>
    <title>Document</title>
  </head>
  <body>
    <button id="pegarNome">getome</button>
    <button id="pagar">pagar</button>
    <button id="mudarNome">mudar nome</button>
    <script>
      let endereco = "0x3d530cab3b7747b5ee189a4e2ef691aa80cba31b";
      let abi = [
    {
      "inputs": [],
      "name": "nome",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "string",
          "name": "_nome",
          "type": "string"
        }
      ],
      "name": "mudarNome",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "loja",
          "type": "address"
        }
      ],
      "name": "pagar",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function",
      "payable": true
    }
  ]

      async function conectar() {
        let resultado = await ethereum.request({
          method: "eth_requestAccounts",
        });
        console.log(resultado);
      }

      async function pagar() {
        const web3 = await new Web3(window.ethereum);
        let contrato = await new web3.eth.Contract(abi, endereco);
        let contas = await web3.eth.getAccounts();
        let conta = contas[0];
        let recipiet = await contrato.methods
          .pagar("0x443AEa45fdc721581B1990aA1040C88185680f75")
          .send({ from: conta, value: 1000000000000000000 });
        console.log(recipiet);
      }

      async function pegarNome() {
        const web3 = await new Web3(window.ethereum);
        let contrato = await new web3.eth.Contract(abi, endereco);
        let nome = await contrato.methods.nome().call();
        console.log(nome);
      }

      async function mudarNome() {
        const web3 = await new Web3(window.ethereum);
        let contrato = await new web3.eth.Contract(abi, endereco);
        let contas = await web3.eth.getAccounts();
        let conta = contas[0]
        let nome = await contrato.methods.mudarNome("tesntado").send({from:conta});
        console.log(nome);
      }

      conectar();

      document.getElementById("pegarNome").addEventListener("click", pegarNome);
      document.getElementById("pagar").addEventListener("click", pagar);
      document.getElementById("mudarNome").addEventListener("click", mudarNome);
    </script>
  </body>
</html>
